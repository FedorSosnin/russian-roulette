:root {
  --wood-dark: #4f2a15;
  --wood-mid: #6b3a1c;
  --wood-light: #8a552e;
  --felt: #2b1b10;
  --text: #f4efe8;
  --accent: #d8c4a5;
  --card-width: clamp(240px, 56vw, 480px);
  --card-height: calc(var(--card-width) * 0.7);
  --stack-offset: 3px;
  --placeholder-offset: 60px;
  --coin-img: url("Assets/Cubes/rr-cube-red.png");
}

* {
  box-sizing: border-box;
}

body {
  margin: 0;
  font-family: "Trebuchet MS", "Gill Sans", "Calibri", sans-serif;
  color: var(--text);
  min-height: 100vh;
  user-select: none;
  -webkit-user-select: none;
  -ms-user-select: none;
  background-color: var(--wood-dark);
  background-image:
    radial-gradient(circle at 20% 10%, rgba(255, 255, 255, 0.08), transparent 40%),
    radial-gradient(circle at 80% 30%, rgba(0, 0, 0, 0.2), transparent 45%),
    url("Assets/Table Texture/wood-table-nlTQ-hLe.jpg");
  background-size: cover;
  background-position: center;
  background-attachment: fixed;
}

html,
body {
  overflow: hidden;
}

body.intro-start .deck {
  display: none;
  pointer-events: none;
}

body.intro-playing .deck {
  display: grid;
  visibility: visible;
  pointer-events: none;
  z-index: 7;
  /* Ensure deck appears above start-screen */
}

.start-screen {
  position: absolute;
  width: var(--card-width);
  height: var(--card-height);
  top: 0;
  left: 50%;
  cursor: pointer;
  opacity: 0;
  pointer-events: none;
  border-radius: 14px;
  background: url("Assets/Icons/rr-deck-placeholder.png") center / cover no-repeat;
  box-shadow: none;
  mix-blend-mode: soft-light;
  transform: translate(-50%, var(--placeholder-offset)) rotate(-1.6deg);
  z-index: 6;
}

body.intro-start .start-screen {
  opacity: 0.6;
  pointer-events: auto;
}

body.intro-playing .start-screen {
  opacity: 0;
  pointer-events: none;
  visibility: hidden;
}

.table {
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  gap: 18px;
  padding: 24px 16px 32px;
}

.play-area {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 70px 12px 32px;
  border-radius: 28px;
  min-height: 300px;
  position: relative;
}

.center-stack {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 28px;
  flex: 1;
  justify-content: center;
  width: 100%;
  position: relative;
  top: -30px;
  z-index: 3;
}

.deck {
  display: grid;
  place-items: center;
  gap: 8px;
  padding: 0;
  cursor: pointer;
  user-select: none;
  position: relative;
  touch-action: manipulation;
  z-index: 5;
  perspective: 1100px;
  width: var(--card-width);
  height: var(--card-height);
}

.deck.dragging {
  z-index: 9;
}

.deck .stack-card {
  position: absolute;
  width: var(--card-width);
  height: var(--card-height);
  top: 0;
  left: 0;
  border-radius: 14px;
  background-image: url("Assets/Cards/rr-card-back.jpg");
  background-size: cover;
  background-position: center;
  box-shadow:
    0 10px 14px rgba(0, 0, 0, 0.22),
    0 4px 6px rgba(0, 0, 0, 0.15);
  --stack-x: 0;
  --stack-y: 0;
  --stack-rot: var(--rot, -1.6deg);
  transform: translate(var(--stack-x), var(--stack-y)) rotate(var(--stack-rot));
  display: none;
}

.deck.receiving {
  z-index: 15;
  animation: deck-receive 240ms ease-in-out infinite alternate;
}

@keyframes deck-receive {
  0% {
    transform: scale(1);
  }

  100% {
    transform: scale(1.1) rotate(1deg) translateY(-5px);
  }
}

.deck-placeholder {
  position: absolute;
  width: var(--card-width);
  height: var(--card-height);
  top: 0;
  left: 0;
  border-radius: 14px;
  object-fit: cover;
  box-shadow: none !important;
  transform: translateY(60px) rotate(-1.6deg);
  mix-blend-mode: soft-light;
  opacity: 0;
  z-index: 0;
  visibility: hidden;
  display: none;
}

.deck-placeholder.visible {
  visibility: visible;
  display: block;
  opacity: 0.6;
}



.deck .stack-card:nth-child(1) {
  --i: 1;
  --rot: -1.8deg;
}

.deck .stack-card:nth-child(2) {
  --i: 2;
  --rot: 1.4deg;
}

.deck .stack-card:nth-child(3) {
  --i: 3;
  --rot: -1.0deg;
}

.deck .stack-card:nth-child(4) {
  --i: 4;
  --rot: 1.6deg;
}

.deck .stack-card:nth-child(5) {
  --i: 5;
  --rot: -1.4deg;
}

.deck .stack-card:nth-child(6) {
  --i: 6;
  --rot: 0.8deg;
}

.deck .stack-card:nth-child(7) {
  --i: 7;
  --rot: -1.2deg;
}

.deck img {
  width: 100%;
  height: 100%;
  border-radius: 14px;
  box-shadow:
    0 12px 18px rgba(0, 0, 0, 0.25),
    0 6px 10px rgba(0, 0, 0, 0.15);
  object-fit: cover;
  position: absolute;
  top: 0;
  left: 0;
  transition: transform 240ms cubic-bezier(0.2, 0.8, 0.2, 1), box-shadow 240ms ease;
  transform-origin: center;
  -webkit-user-drag: none;
  user-select: none;
}

#deck-top {
  width: var(--card-width);
  height: var(--card-height);
  position: relative;
  /* Start at default stack position */
  --stack-x: 0;
  --stack-y: 0;
  --stack-rot: -1.6deg;
  transform: translate(var(--stack-x), var(--stack-y)) rotate(var(--stack-rot));
  transform-origin: center;
  transition: transform 1s ease;
  pointer-events: auto;
  visibility: hidden;
  opacity: 0;
}

#deck-top.stack-enter {
  animation: stack-in 320ms ease-out forwards;
  visibility: visible !important;
  opacity: 1 !important;
}



#deck-top.stop-animation {
  animation: none !important;
}

/* Hover & Drag Effects */
#deck-top:hover img,
#deck-top.dragging img {
  transform: scale(1.04);
  box-shadow:
    0 22px 32px rgba(0, 0, 0, 0.35),
    0 10px 18px rgba(0, 0, 0, 0.25);
  cursor: grab;
}

#deck-top.dragging img {
  cursor: grabbing;
}

@keyframes deck-float {

  0%,
  100% {
    transform: translate(var(--stack-x), var(--stack-y)) rotate(var(--stack-rot)) scale(1);
  }

  50% {
    transform: translate(calc(var(--stack-x) + 1px), calc(var(--stack-y) - 6px)) rotate(calc(var(--stack-rot) + 0.8deg)) scale(1.015);
  }
}

#deck-top:not(.stack-enter):not(.dragging):not(.stack-offscreen):not(.paused) {
  animation: deck-float 3.2s ease-in-out infinite;
  will-change: transform;
}

#deck-top.paused {
  animation-play-state: paused !important;
}

#deck-top.paused,
#deck-top.dragging {
  transition: none !important;
}

/* Fix z-index when dragging */
.deck #deck-top.dragging {
  z-index: 100;
}

body.intro-loading .deck,
body.intro-loading .deck * {
  visibility: visible;
}

.stack-offscreen {
  transform: translate(var(--stack-x), calc(var(--stack-y) - 130vh)) rotate(calc(var(--stack-rot) + 6deg));
}

.deck.disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.cards-area {
  width: var(--card-width);
  height: var(--card-height);
  position: relative;
  margin-top: 35px;
  z-index: 3;
  cursor: pointer;
}

.cards-area.dealing {
  z-index: 15;
}

.cards-area.dragging {
  z-index: 12;
}

.card {
  width: var(--card-width);
  height: var(--card-height);
  perspective: 1000px;
  position: relative;
  position: absolute;
  top: 0;
  left: 0;
  transform: translate(var(--to-x, 0px), var(--to-y, 0px)) rotate(var(--tilt, 0deg));
  z-index: 2;
}

.card.deal {
  animation: deal-move 380ms ease-out;
  z-index: 10;
}

.card.dragging {
  z-index: 9;
}

.card-inner {
  width: 100%;
  height: 100%;
  transform-style: preserve-3d;
  animation: flip 420ms ease-out forwards;
}

.card-face {
  position: absolute;
  inset: 0;
  backface-visibility: hidden;
  border-radius: 16px;
  box-shadow:
    0 14px 20px rgba(0, 0, 0, 0.22),
    0 6px 10px rgba(0, 0, 0, 0.15);
  overflow: hidden;
}

.card-back {
  transform: rotateX(0deg);
}

.card-front {
  transform: rotateX(-180deg);
}

.card-face img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  display: block;
}


@keyframes deal-move {
  from {
    transform: translate(var(--from-x), var(--from-y)) rotate(var(--tilt, 0deg));
  }

  to {
    transform: translate(var(--to-x, 0px), var(--to-y, 0px)) rotate(var(--tilt, 0deg));
  }
}

.card.deal.custom-start {
  animation: deal-move-custom 420ms cubic-bezier(0.2, 1, 0.3, 1) forwards;
}

@keyframes deal-move-custom {
  from {
    transform: translate(var(--from-x), var(--from-y)) rotate(var(--from-tilt, 0deg));
  }

  to {
    transform: translate(var(--to-x, 0px), var(--to-y, 0px)) rotate(var(--tilt, 0deg));
  }
}

@keyframes flip {
  to {
    transform: rotateX(-180deg);
  }
}

.card.bang-impact {
  animation: card-bang-shake 400ms cubic-bezier(0.36, 0.07, 0.19, 0.97) both;
  z-index: 100 !important;
}

@keyframes card-bang-shake {
  0% {
    transform: translate(0, 0) rotate(0deg) scale(1);
  }

  15% {
    transform: translate(-4px, -2px) rotate(-1.5deg) scale(1.2);
  }

  30% {
    transform: translate(5px, 3px) rotate(2deg) scale(1.35);
  }

  45% {
    transform: translate(-6px, -1px) rotate(-2.5deg) scale(1.4);
  }

  60% {
    transform: translate(5px, 2px) rotate(1.5deg) scale(1.3);
  }

  75% {
    transform: translate(-3px, -1px) rotate(-1deg) scale(1.15);
  }

  100% {
    transform: translate(0, 0) rotate(0deg) scale(1);
  }
}


.card.return {
  animation: deal-return 320ms cubic-bezier(0.5, 0, 0, 1) forwards;
}

.card.return .card-inner {
  animation: flip-return 350ms ease forwards;
}

@keyframes deal-return {
  from {
    transform: translate(var(--to-x, 0px), var(--to-y, 0px)) rotate(var(--tilt, 0deg));
  }

  to {
    transform: translate(var(--from-x), var(--from-y)) rotate(var(--from-tilt, 0deg)) scale(0.5);
    opacity: 0;
  }
}

@keyframes flip-return {
  from {
    transform: rotateX(-180deg);
  }

  to {
    transform: rotateX(0deg);
  }
}

.stack-enter {
  /* No longer using animation, using transition instead */
}

.counters {
  display: flex;
  align-items: center;
  justify-content: center;
  /* Changed from flex-start to center */
  margin-top: -19px;
  /* Moved up 25px from original 6px */
  width: var(--card-width);
  min-height: 78px;
  cursor: pointer;
  position: relative;
  /* Fixed: Added relative positioning */
  z-index: 20;
  /* Fixed: High z-index to stay above cards */
}

.coin-row {
  display: flex;
  align-items: center;
  justify-content: center;
  /* Added to ensure children are centered */
}

.counter-dot {
  width: 78px;
  height: 78px;
  background: url("Assets/Coins/coin.png") center/contain no-repeat;
  box-shadow: none;
  transform: translateY(var(--coin-y, 0px)) rotate(var(--coin-rot, 0deg));
  transition: transform 160ms ease;
}

.counter-dot.active {
  transform: translateY(var(--coin-y, 0px)) rotate(var(--coin-rot, 0deg));
}

.coin-row .counter-dot+.counter-dot {
  margin-left: -8px;
}

.counter-dot.coin-enter {
  animation: coin-drop 450ms cubic-bezier(0.2, 0.8, 0.2, 1) forwards;
  overflow: hidden;
  /* Prevent visual artifacts during width expansion */
}

@keyframes coin-drop {
  from {
    width: 0;
    opacity: 0;
    transform: translateY(calc(var(--coin-y, 0px) + 80px)) rotate(calc(var(--coin-rot, 0deg) - 20deg)) scale(0.6);
  }

  to {
    width: 78px;
    opacity: 1;
    transform: translateY(var(--coin-y, 0px)) rotate(var(--coin-rot, 0deg)) scale(1);
  }
}

.counter-dot.fade-out {
  animation: coin-exit 420ms ease-in forwards;
}

/* Counter Dragging Effects */
.counters.dragging {
  cursor: grabbing;
  z-index: 100 !important;
  transition: none !important;
}

.counters.dragging .counter-dot+.counter-dot {
  margin-left: -66px !important;
  /* Overlap only subsequent coins */
}

.counters.dragging .counter-dot {
  transition: margin 200ms cubic-bezier(0.2, 0.8, 0.2, 1);
  box-shadow: none !important;
  /* Ensure no shadows on individual cubes */
}

.counters .counter-dot {
  transition: margin 300ms cubic-bezier(0.2, 0.8, 0.2, 1), transform 240ms cubic-bezier(0.2, 0.8, 0.2, 1), box-shadow 200ms ease;
}

/* Hover Preparation Effects */
.counters:hover .counter-dot {
  transform: translateY(var(--coin-y, 0px)) rotate(var(--coin-rot, 0deg)) scale(1.15);
}

.counters:hover .counter-dot+.counter-dot {
  margin-left: -24px;
  /* Tighten up just a bit (between -8px and -52px) */
}

/* More natural variation for the stack effect */
.counters.dragging .counter-dot:nth-child(1) {
  transform: translateY(-4px) rotate(5deg);
}

.counters.dragging .counter-dot:nth-child(2) {
  transform: translateY(6px) rotate(-8deg);
}

.counters.dragging .counter-dot:nth-child(3) {
  transform: translateY(-7px) rotate(12deg);
}

.counters.dragging .counter-dot:nth-child(4) {
  transform: translateY(3px) rotate(-6deg);
}

.counters.dragging .counter-dot:nth-child(5) {
  transform: translateY(-8px) rotate(9deg);
}

.counters.dragging .counter-dot:nth-child(6) {
  transform: translateY(5px) rotate(-10deg);
}

.counters.dragging .counter-dot:nth-child(7) {
  transform: translateY(-3px) rotate(4deg);
}

@keyframes coin-exit {
  from {
    transform: translateY(var(--coin-y, 0px)) rotate(var(--coin-rot, 0deg));
    opacity: 1;
  }

  to {
    transform: translateY(calc(var(--coin-y, 0px) + 120px)) rotate(calc(var(--coin-rot, 0deg) + 15deg));
    opacity: 0;
  }
}

@media (max-width: 900px) {
  :root {
    --card-width: clamp(280px, 84vw, 560px);
    --placeholder-offset: 60px;
  }

  .play-area {
    flex-direction: column;
    padding: 90px 12px 28px;
  }

  .center-stack {
    gap: 42px;
    top: -60px;
  }

  .counters {
    gap: 0;
    margin-left: -49px;
  }

  .coin-row .counter-dot+.counter-dot {
    margin-left: -24px;
  }

  .deck {
    justify-self: center;
  }

}


.version-tag {
  position: fixed;
  left: 12px;
  bottom: 12px;
  font-size: 8pt;
  color: #D2B48C;
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.6);
  letter-spacing: 0.3px;
  pointer-events: none;
}